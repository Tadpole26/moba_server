{%- set keyField = namespace(type='', mem_name='', pb_name='', cache_name='') -%}
{%- for field in field_list %}
{%- if field.m_strFKey == True %}
{%-set keyField.type = field.m_strType -%}
{%-set keyField.mem_name = field.m_strMemName -%}
{%-set keyField.pb_name = field.m_strPbName -%}
{%-set keyField.cache_name = field.m_strCacheName -%}
{%-endif %}
{%- endfor %}
#pragma once
#include "dtype.h"
#include "{{st_file}}.h"

struct {{db_name}}
{
    static const char* tb_name;
    {%- for field in field_list %}
    {%- if field.m_strKey == True %}
    static const char* id;
    {%- else %}
    static const char* {{field.m_strName}};
    {%- endif %}
    {%- endfor %}
}

class CDBUser;
class {{dbpkg_name}}
{
public:
    static void OnUpdate{{col_name}}(unsigned char* pMsg, size uiLen);

    static bool ReadDB{{col_name}}(sDBSecRet& vecMap, CDBUser* pUser);

    void Get{{col_name}}(DBGS_UserData& oData);

{%- if col_type == 'object' %}
    {{st_name}}& Get{{col_name}}Info() { return m_o{{col_name}}; }
{%- endif %}
private:
    bool Update{{col_name}}(Msg_DBGS_Update{{col_name}}& oUpdate);

{%- if col_type == 'list' %}
    bool AddDB{{col_name}}(const Msg_DBGS_Update{{col_name}}& oUpdate);
    bool UpdateDB{{col_name}}(const Msg_DBGS_Update{{col_name}}& oUpdate);
    bool DeleteOneDB{{col_name}}(const Msg_DBGS_Update{{col_name}}& oUpdate);
    bool DeleteAllDB{{col_name}}(const Msg_DBGS_Update{{col_name}}& oUpdate);
    std::map<{{keyField.type}}, {{st_name}}> m_map{{col_name}};
{%- else %}
    bool AddOrUpdateDB{{col_name}}(const Msg_DBGS_Update{{col_name}}& oUpdate);
    {{ st_name }} m_o{{col_name}};
{%- endif %}
};